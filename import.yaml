---
# Semaphore Project Import Configuration
# File: import.yaml
# Usage: Use this to quickly configure your Semaphore project
name: trying
project:
  name: boiler-deploy
  alert: false

keys:
  - name: deploy_key
    type: ssh
    login: root
    # STEP 1: Replace with your private key
    # Run: cat /home/basthook/.ssh/Hosting
    private_key: |
      -----BEGIN OPENSSH PRIVATE KEY-----
      PASTE_YOUR_PRIVATE_KEY_CONTENT_HERE
      -----END OPENSSH PRIVATE KEY-----

repositories:
  - name: local-playbooks
    url: /ansible
    branch: streamlit
    key: none

inventory:
  production:
    type: static
    content: |
      all:
        children:
          webservers:
            hosts:
              production-web-01:
                ansible_host: YOUR_SERVER_IP_1
                ansible_user: root
                ansible_port: 22
                ansible_python_interpreter: /usr/bin/python3
                ansible_ssh_private_key_file: /home/basthook/.ssh/Hosting
                ansible_become: yes
                app_port: 3002

  dev:
    type: static
    content: |
      all:
        children:
          webservers:
            hosts:
              dev-web-01:
                ansible_host: YOUR_DEV_IP
                ansible_user: root
                ansible_port: 22
                ansible_python_interpreter: /usr/bin/python3
                ansible_ssh_private_key_file: /home/basthook/.ssh/Hosting
                ansible_become: yes
                app_port: 3002

environment:
  production-vars:
    json:
      app_name: myapp
      app_repo: https://github.com/Bastiblast/ansible-next-test.git
      app_branch: main
      nodejs_version: "20"
      app_port: "3002"
      deploy_user: root
      timezone: Europe/Paris
      pm2_instances: "2"
      pm2_max_memory: 512M

  dev-vars:
    json:
      app_name: myapp-dev
      app_repo: https://github.com/Bastiblast/ansible-next-test.git
      app_branch: develop
      nodejs_version: "20"
      app_port: "3002"
      deploy_user: root
      timezone: Europe/Paris
      pm2_instances: "1"
      pm2_max_memory: 256M

templates:
  - name: "01 - Provision Server"
    playbook: playbooks/provision.yml
    inventory: production
    environment: production-vars
    repository: local-playbooks
    ssh_key: deploy_key

  - name: "02 - Deploy Application"
    playbook: playbooks/deploy.yml
    inventory: production
    environment: production-vars
    repository: local-playbooks
    ssh_key: deploy_key

  - name: "03 - Update Application"
    playbook: playbooks/update.yml
    inventory: production
    environment: production-vars
    repository: local-playbooks
    ssh_key: deploy_key

  - name: "04 - Rollback"
    playbook: playbooks/rollback.yml
    inventory: production
    environment: production-vars
    repository: local-playbooks
    ssh_key: deploy_key
