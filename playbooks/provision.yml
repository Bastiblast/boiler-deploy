---
- name: Provision all servers
  hosts: all
  become: yes
  gather_facts: yes

  pre_tasks:
    - name: Wait for system to become reachable
      wait_for_connection:
        timeout: 300

    - name: Gather facts
      setup:

  roles:
    - common
    - security

- name: Setup database servers
  hosts: dbservers
  become: yes

  roles:
    - postgresql

- name: Setup web servers
  hosts: webservers
  become: yes

  roles:
    - nodejs
    - nginx

- name: Setup monitoring
  hosts: all
  become: yes

  roles:
    - monitoring

- name: Display summary
  hosts: all
  gather_facts: no
  run_once: yes

  tasks:
    - name: Show provisioning summary
      debug:
        msg:
          - "=========================================="
          - "Provisioning completed successfully!"
          - "=========================================="
